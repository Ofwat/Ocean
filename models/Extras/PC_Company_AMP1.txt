with PR14 as (

    select * from {{ ref('PR14_FD_outcome_New_CSV') }}

),

PC1 as (

    select * from {{ ref('Primary_category') }}

),

Company as (

    select * from {{ ref('Companies') }}

),

Element as (

    select * from {{ ref('Elements') }}

),

final as (
select PC1.PC_id PC_ID,
        20141231 Date_ID,
        PC1.Performance_commitment
      /*[Unique ID] Unique_ID
      ,PC.PC_ID PC_ID
      ,[PC ref. (company)] PC_ref_company
	  , 20141231 Date_ID,
	    d_co.water_company_code Water_Company_Accronym,
	 d_co.water_Company_ID Water_Company_ID,
	 d_e.Element_ID Element_ID
      ,[PR14 Annex 4 order] PR14_Annex_4_order
      ,[ODI type] ODI_type
      ,[ODI form] ODI_form
      ,[In-period ODI] In_period_ODI
      ,case when upper([Standard ('vanilla') financial ODI])='NO' then 0
when upper([Standard ('vanilla') financial ODI])='YES' then 1
else null end as Standard_vanilla_financial_ODI
    , [Direction of improving performance] Direction_of_improving_performance
      ,[Drinking water quality compliance] Drinking_water_quality_compliance
      ,[Water quality contacts] Water_quality_contacts
      ,[Supply interruptions (>3 hours)] Supply_interruptions_3_hours
      ,[Pollution incidents (cat 3)] Pollution_incidents_cat_3
      ,[Internal sewer flooding] Internal_sewer_flooding
      ,[Scheme specific factors (all or part)] Scheme_specific_factors_all_or_part
      ,[Asset health/ resilience (all or part)] Asset_health_resilience_all_or_part
      ,[NEP (all or part)] NEP_all_or_part
      ,[AIM] AIM
      ,[No. of sub-measures] No_of_sub_measures
      ,[Standard ODI operand] Standard_ODI_operand
      ,[Standard ODI operand note] Standard_ODI_operand_note*/
FROM PR14 PR14 
left join PC1 on ltrim(right(PR14.Performance_commitment, len(PR14.Performance_commitment) - charindex(':',PR14.Performance_commitment))) = PC1.Performance_commitment
	and PR14.[PC_unit]=PC1.[PC_unit]
    and PR14.[PC_unit_description] = PC1.[PC_unit_description]
    and PR14.[Decimal_places]=PC1.[Decimal_places]
    left join Company d_co on PR14.Company=d_co.Company
	left join Element d_e on PR14.[Element_acronym]=d_e.Element_acronym
    )

select * from final